<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title><%= title %></title>
    <link rel='stylesheet' href='/css/styleNav.css'/>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel='stylesheet' href='/css/styleMateriais.css' />
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  
  </head>
  <body>
    <div id="nav2">
      <%- include partials/_navbar4.ejs %>
    </div>

      <div class="container">
          <div class="card-body mt-04">
            <div class="atk">

              <div class='wrapper text-center'>
                <div class="btn-group" role="group" aria-label="1bt">
                  <button id="bt1" onclick="getPDF();" class="btn btn-success align-self-center text-center">
                    PDF <i class="fa fa-download"></i>
                  </button>
                </div>
                <div class="btn-group" role="group" aria-label="2bt">
                  <a id="bt2" href="/sizer" class="btn btn-success align-self-center text-center">
                    Editar Projeto <i class="fa fa-plus" aria-hidden="true"></i>
                  </a>
                </div>
                <div class="btn-group" role="group" aria-label="1bt">
                  <div class="btnRelatorio">
                    <a href="/relatorio" class="btn btn-success"><i class="fa fa-list-ol" aria-hidden="true"></i> Relatório</a>
                  </div>
                </div>
              </div>

                  <div id="content">
                    <div class="container">
                      <div class="row align-self-center text-center">
                        <div class="col-3">
                          <img src="/images/IFlogo.png" alt="" width="123" height="143">
                        </div>
                        <div class="col-6 align-self-center text-center">
                          <h2 id="title" ><%= title %></h2>
                        </div>
                        <div class="col-3">
                          <img src="/images/logo3.png" alt="" width="100" height="143">
                        </div>
                      </div>
                    <hr>
                    
                    <p>Itens escolhidos: <%= lista.length %></p>

                    <div class="table-container3">
                      <table id="myTable" class="table mt-04 table-sm table-responsive">
                        <thead class="thead-dark">
                          <tr align="center">
                            <th class="align-middle" scope="col">Quantidade</th>
                            <th class="align-middle" scope="col">Descrição</th>
                            <th class="align-middle" scope="col">Código</th>
                          </tr>
                        </thead>
                        <tbody id="myTableBody">
                          <% lista.forEach(function(item){ %>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd1 * item.QTDE %></td>
                              <td><%= item.desc1 %></td>
                              <td><%= item.cod1 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd2 * item.QTDE %></td>
                              <td><%= item.desc2 %></td>
                              <td><%= item.cod2 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd3 * item.QTDE %></td>
                              <td><%= item.desc3 %></td>
                              <td><%= item.cod3 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd4 * item.QTDE %></td>
                              <td><%= item.desc4 %></td>
                              <td><%= item.cod4 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd5 * item.QTDE %></td>
                              <td><%= item.desc5 %></td>
                              <td><%= item.cod5 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd6 * item.QTDE %></td>
                              <td><%= item.desc6 %></td>
                              <td><%= item.cod6 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd7 * item.QTDE %></td>
                              <td><%= item.desc7 %></td>
                              <td><%= item.cod7 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd8 * item.QTDE %></td>
                              <td><%= item.desc8 %></td>
                              <td><%= item.cod8 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd9 * item.QTDE %></td>
                              <td><%= item.desc9 %></td>
                              <td><%= item.cod9 %></td>
                            </tr>
                            <tr id="item-row" class="print" align="center" valign="middle">
                              <td id="field"><%= item.qtd10 * item.QTDE %></td>
                              <td><%= item.desc10 %></td>
                              <td><%= item.cod10 %></td>
                            </tr>
                          <% }) %>
                        </tbody>
                      </table>
                    </div>
                    <br>
                    <hr>
              <div id="elementH"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <script type="text/javascript">
  //FUNÇÃO QUE ENTRA LOGO QUANDO CARREGA A PÁGINA
    ( function($) {
      $(function() {
        iMasters.refresh();
      });
      var iMasters = {
        refresh : function() {
          //Função que dá refresh na página apenas uma vez na primeira vez
          if( window.localStorage )
          {
            if( !localStorage.getItem('firstLoad') )
            {
              localStorage['firstLoad'] = true;
              window.location.reload();
            }  
            else
              localStorage.removeItem('firstLoad');
          }
          iMasters.view();
        },
        view : function() {
          var tbl = document.getElementById('myTable');
          var rows = tbl.querySelectorAll('tbody tr');
          
          console.log(rows);
          for(i = 0; i < rows.length; i++) {   
            var cells = rows[i].querySelectorAll('td');
            var cod = cells[2].innerHTML;

            console.log(cod);
            if (cod == null || typeof cod == "undefined" || !cod) {
                rows[i].classList.add('hide');
            } else { 
                rows[i].classList.remove('hide');
            }
          }
          iMasters.view2();
        },
        view2 : function() {
          var tbl = document.getElementById('myTable2');
          var rows = tbl.querySelectorAll('tbody tr');
          
          console.log(rows);
          for(i = 0; i < rows.length; i++) {   
            var cells = rows[i].querySelectorAll('td');
            var cod = cells[2].innerHTML;

            console.log(cod);
            if (cod == null || typeof cod == "undefined" || !cod) {
                rows[i].classList.add('hide');
            } else { 
                rows[i].classList.remove('hide');
            }
          }
        }
        
      };
    })(jQuery);

  </script>
  <script>
    function convertToPDF() {
      var doc = new jsPDF();
      var elementHTML = $('#content').html();
      var specialElementHandlers = {
        '#elementH': function(element, renderer) {
          return true;
        } 
      };

      doc.fromHTML(elementHTML, 15, 15, {
        'width': 170,
        'elementHandlers': specialElementHandlers
      });
      
      doc.save('document.pdf');
    };

    function createPDF() {
      html2canvas(document.getElementById("content"), {
        onrendered: function(canvas) {
          var img = canvas.toDataURL('image/png');
          var doc = new jsPDF();

          doc.addImage(img, 'JPEG', 20, 20);
          doc.save('test.pdf');
        }
      });
    };

    function getPDF(){
      var HTML_Width = $("#content").width();
      var HTML_Height = $("#content").height();
      var top_left_margin = 15;
      var PDF_Width = HTML_Width+(top_left_margin*2);
      var PDF_Height = (PDF_Width*1.5)+(top_left_margin*2);
      var canvas_image_width = HTML_Width;
      var canvas_image_height = HTML_Height;

      var totalPDFPages = Math.ceil(HTML_Height/PDF_Height)-1;


      html2canvas($("#content")[0],{allowTaint:true}).then(function(canvas) {
        canvas.getContext('2d');
        
        var imgData = canvas.toDataURL("image/png", 1.0);
        var pdf = new jsPDF('p', 'pt',  [PDF_Width, PDF_Height]);

          pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
        
        
        for (var i = 1; i <= totalPDFPages; i++) { 
          pdf.addPage(PDF_Width, PDF_Height);
          pdf.addImage(imgData, 'JPG', 1+top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
        }
        
        pdf.save("list.pdf");
      });
    };


    function generatePDF(){
      var doc = new jsPDF();
      //Landscape:
      //var doc = new jsPDF({orientation: 'landscape'});

      doc.text(20, 20, 'Olá Mundo!');

      doc.text(20, 30, 'Este é o lado JavaScript para gerar um PDF.');

      doc.text(20, 40, 'This is the default font.');

      //Diferentes Fontes
      doc.setFont("courier");
      doc.setFontType("normal");
      doc.text(20, 50, 'This is courier normal.');

      doc.setFont("times");
      doc.setFontType("italic");
      doc.text(20, 60, 'This is times italic.');

      doc.setFont("helvetica");
      doc.setFontType("bold");
      doc.text(20, 70, 'This is helvetica bold.');

      doc.setFont("courier");
      doc.setFontType("bolditalic");
      doc.text(20, 80, 'This is courier bolditalic.');

      // Add new page
      doc.addPage();
      doc.text(20, 20, 'Jonathan Tobias');

      //Difentes Tamanhos de Fontes:
      doc.setFontSize(24);
      doc.text(20, 30, 'This is a title');

      doc.setFontSize(16);
      doc.text(20, 40, 'This is some normal sized text underneath.');

      doc.addPage();
      doc.setTextColor(100);
      doc.text(20, 20, 'This is gray.');

      doc.setTextColor(150);
      doc.text(20, 30, 'This is light gray.');

      doc.setTextColor(255,0,0);
      doc.text(20, 40, 'This is red.');

      doc.setTextColor(0,255,0);
      doc.text(20, 50, 'This is green.');

      doc.setTextColor(0,0,255);
      doc.text(20, 60, 'This is blue.');

      // Save the PDF
      doc.save('document.pdf');
    }
    
  </script>
</html>